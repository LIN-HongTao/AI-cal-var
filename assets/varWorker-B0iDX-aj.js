(function(){"use strict";function k(t){let o=0;for(const n of t)o+=n;return o/t.length}function w(t){const o=k(t);let n=0;for(const s of t){const e=s-o;n+=e*e}return Math.sqrt(n/(t.length-1))}function P(t,o){function n(r){const l=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];if(r<.5)return Math.log(Math.PI)-Math.log(Math.sin(Math.PI*r))-n(1-r);r-=1;let c=l[0];for(let h=1;h<l.length;h++)c+=l[h]/(r+h);const i=r+7+.5;return .5*Math.log(2*Math.PI)+(r+.5)*Math.log(i)-i+Math.log(c)}const s=n((o+1)/2)-n(o/2)-.5*Math.log(o*Math.PI);let e=0;for(const r of t)e+=s-(o+1)/2*Math.log(1+r*r/o);return e}function b(t,o=3,n=60){const s=k(t),e=w(t);if(e<=0)return 5;const r=t.map(c=>(c-s)/e);let a=o,l=-1e100;for(let c=o;c<=n;c++){const i=P(r,c);i>l&&(l=i,a=c)}return a}function p(){let t=0,o=0;for(;t===0;)t=Math.random();for(;o===0;)o=Math.random();return Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*o)}function x(t){let o=p(),n=0;for(let s=0;s<t;s++){const e=p();n+=e*e}return o/Math.sqrt(n/t)}function q(t,o){const n=[...t].sort((a,l)=>a-l),s=(n.length-1)*o,e=Math.floor(s),r=s-e;return n[e+1]!==void 0?n[e]+r*(n[e+1]-n[e]):n[e]}self.onmessage=t=>{const{task:o,payload:n}=t.data;if(o==="mcSingle"){const{r:s,conf:e,T:r,sims:a,method:l,dfMax:c}=n,i=1-e;if(s.length<2){self.postMessage({ok:!0,var:NaN});return}const h=k(s),m=w(s);if(l==="normal"){const f=new Float64Array(a);for(let u=0;u<a;u++){let g=0;for(let M=0;M<r;M++)g+=h+m*p();f[u]=g}const d=-q(f,i);self.postMessage({ok:!0,var:d,mu:h,sigma:m});return}if(l==="t_auto"){const f=b(s,3,c),d=f>2?m*Math.sqrt((f-2)/f):m,u=new Float64Array(a);for(let M=0;M<a;M++){let v=0;for(let I=0;I<r;I++)v+=h+d*x(f);u[M]=v}const g=-q(u,i);self.postMessage({ok:!0,var:g,mu:h,sigma:m,dfHat:f});return}if(l==="bootstrap"){const f=new Float64Array(a);for(let u=0;u<a;u++){let g=0;for(let M=0;M<r;M++){const v=Math.random()*s.length|0;g+=s[v]}f[u]=g}const d=-q(f,i);self.postMessage({ok:!0,var:d});return}}}})();
